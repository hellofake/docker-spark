#!/bin/bash
SPARK_ZOOKEEPER_URL=192.168.6.168:2181,192.168.6.167:2181,192.168.6.172:2181
ZOO_IP_IDS=192.168.6.168:1,192.168.6.167:2,192.168.6.172:3
CURRENT_IP=192.168.6.167
MASTER_ADDR=192.168.6.168:7077,192.168.6.167:7077,192.168.6.172:7077
SPARK_LOGS_MNT_PATH=/home/docker/spark_logs
SPARK_WORK_HOME=/home/docker/spark_work
SPARK_CHECK_INTERVAL=600
SPARK_CLEAN_TIMEOUT=3600
MASTER_OR_SLAVE=master
NFS_MNT=/nfs/mnt
mkdir -p ${SPARK_LOGS_MNT_PATH}
chown -R 1000:1000 ${SPARK_LOGS_MNT_PATH}
mkdir -p ${SPARK_WORK_HOME}
chown -R 1000:1000 ${SPARK_WORK_HOME}
docker run -itd --privileged=true -e "TZ=Asia/Shanghai" -e "SPARK_ZOOKEEPER_URL=${SPARK_ZOOKEEPER_URL}" -e "SPARK_CHECK_INTERVAL=${SPARK_CHECK_INTERVAL}"  -e "SPARK_CLEAN_TIMEOUT=${SPARK_CLEAN_TIMEOUT}"  -e "ZOO_IP_IDS=${ZOO_IP_IDS}" -e "CURRENT_IP=${CURRENT_IP}" -e "MASTER_ADDR=${MASTER_ADDR}" -v ${NFS_MNT}:${NFS_MNT} -v ${SPARK_WORK_HOME}:/usr/local/spark-2.2.0-bin-hadoop2.7/work -v ${SPARK_LOGS_MNT_PATH}:/usr/local/spark-2.2.0-bin-hadoop2.7/logs  --network host link2map/spark:1.0 ${MASTER_OR_SLAVE}
